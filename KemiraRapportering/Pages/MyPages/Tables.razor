@using DataAccesLib.Models
@using DataAccesLib
@using BlazorDateRangePicker;


  <div>
      <table class="table table-striped">
        <thead>
            <tr>
    
                @foreach(var Var in filter)
                    {
                       @if(!Var.sort)
                       {<th>@Var.variable</th>}
                        
                    }
                

            </tr>
        </thead>
        <tbody>
                

                @foreach (var recipe in RecipeRead.Table)
            {


                    @if (!recipe.edit)
                    {
                        <tr @key="recipe">

                           @if(!filter[0].sort)
                    {<td>@recipe.BatchNr</td>}
                    @if(!filter[1].sort)
                    {<td>@recipe.Dato</td>}
                    @if(!filter[2].sort)
                    {<td>@recipe.SAP</td>}
                    
                    @if(!filter[3].sort)
                    {<td>@recipe.ID</td>}
                    
                    @if(!filter[4].sort)
                    {<td>@recipe.Reaktor</td>}
                    
                    @if(!filter[5].sort)
                    {<td>@recipe.SatsVolum</td>}
                    
                    @if(!filter[6].sort)
                    {<td>@recipe.ForvFe</td>}
                    
                    @if(!filter[7].sort)
                    {<td>@recipe.OnsketFe</td>}
                    
                    @if(!filter[8].sort)
                    {<td>@recipe.OnsketSyre</td>}
                    
                    @if(!filter[9].sort)
                    {<td>@recipe.OnsketFe2</td>}
                    
                    @if(!filter[10].sort)
                    {<td>@recipe.HCLType</td>}
                    
                    @if(!filter[11].sort)
                    {<td>@recipe.ForvDamp</td>}
                    
                    @if(!filter[12].sort)
                    {<td>@recipe.VannOverordnet</td>}
                    
                    @if(!filter[13].sort)
                    {<td>@recipe.VarmtVann</td>}
                    
                    @if(!filter[14].sort)
                    {<td>@recipe.SpillVann</td>}
                    
                    @if(!filter[15].sort)
                    {<td>@recipe.ScrubberVaeske</td>}
                    
                    @if(!filter[16].sort)
                    {<th>@recipe.HCL</th>}
                    
                    @if(!filter[17].sort)
                    {<th>@recipe.Jernsulfat</th>}
                    
                    @if(!filter[18].sort)
                    {<th>@recipe.Temp</th>}
                    
                    @if(!filter[19].sort)
                    {<th>@recipe.Modningstid</th>}
                    
                    @if(!filter[20].sort)
                    {<th>@recipe.DampVentil</th>}
                    
                    @if(!filter[21].sort)
                    {<th>@recipe.Etterspyling</th>}
                    
                    @if(!filter[22].sort)
                    {<th>@recipe.O2Trykk</th>}
                    
                    @if(!filter[23].sort)
                    {<th>@recipe.O2Reaksjonstid</th>}
                    
                    @if(!filter[24].sort)
                    {<th>@recipe.DeltaTemp</th>}
                    
                    @if(!filter[25].sort)
                    {<th>@recipe.AnalysertFe3</th>}
                    
                    @if(!filter[26].sort)
                    {<th>@recipe.AnalysertFeTot</th>}
                    
                    @if(!filter[27].sort)
                    {<th>@recipe.VannSluttJustering</th>}
                    
                    @if(!filter[28].sort)
                    {<th>@recipe.VirkeligMVann</th>}
                    
                    @if(!filter[29].sort)
                    {<th>@recipe.TotTilLager</th>}



                    <th>
                        <button type="button" class="btn btn-link">
                        <span class="oi oi-pencil" aria-hidden="true" @onclick="() => EnableEditing(true, recipe)"></span>
                        </button>
                    </th>
                        
                        </tr>
                    }
                    else
                    {
                             @if (!filter[0].sort)
                            {
                                <td>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.BatchNr" @bind-value:event="oninput" />
</td>
                            }
                            @if (!filter[1].sort)
                            {
                                <td>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.Dato" @bind-value:event="oninput" />
</td>
                            }
                            @if (!filter[2].sort)
                            {
                                <td>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.SAP" @bind-value:event="oninput" />
                                </td>
                            }

                            @if (!filter[3].sort)
                            {
                                <td>
                                <input type="text" class="form-control" @bind-value="RecipeEdit.ID" @bind-value:event="oninput" />
                                 </td>
                            }

                            @if (!filter[4].sort)
                            {
                                <td>

                                <input type="number" class="form-control" @bind-value="RecipeEdit.Reaktor" @bind-value:event="oninput" />
</td>
                            }
                             @if (!filter[5].sort)
                            {
                                <th>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.SatsVolum" @bind-value:event="oninput" />
</th>
                            }

                            @if (!filter[6].sort)
                            {
                                <td>

                                <input type="number" class="form-control" @bind-value="RecipeEdit.ForvFe" @bind-value:event="oninput" />
</td>
                            }

                            @if (!filter[7].sort)
                            {
                                <td>

                                <input type="number" class="form-control" @bind-value="RecipeEdit.OnsketFe" @bind-value:event="oninput" />
</td>
                            }

                            @if (!filter[8].sort)
                            {
                                <td>

                                <input type="number" class="form-control" @bind-value="RecipeEdit.OnsketSyre" @bind-value:event="oninput" />
</td>
                            }

                            @if (!filter[9].sort)
                            {
                                <td>

                                <input type="number" class="form-control" @bind-value="RecipeEdit.OnsketFe2" @bind-value:event="oninput" />
</td>
                            }

                            @if (!filter[10].sort)
                            {
                                <td>

                                <input type="number" class="form-control" @bind-value="RecipeEdit.HCLType" @bind-value:event="oninput" />
</td>
                            }

                            @if (!filter[11].sort)
                            {
                                <td>

                                <input type="number" class="form-control" @bind-value="RecipeEdit.ForvDamp" @bind-value:event="oninput" />
</td>
                            }

                            @if (!filter[12].sort)
                            {
                                <td>

                                <input type="number" class="form-control" @bind-value="RecipeEdit.VannOverordnet" @bind-value:event="oninput" />
</td>
                            }

                            @if (!filter[13].sort)
                            {
                                <td>

                                <input type="number" class="form-control" @bind-value="RecipeEdit.VarmtVann" @bind-value:event="oninput" />
</td>
                            }

                            @if (!filter[14].sort)
                            {
                                <td>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.SpillVann" @bind-value:event="oninput" />
</td>
                            }

                            @if (!filter[15].sort)
                            {
                                <td>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.ScrubberVaeske" @bind-value:event="oninput" />
</td>
                            }

                            @if (!filter[16].sort)
                            {
                                <td>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.HCL" @bind-value:event="oninput" />
</td>
                            }

                            @if (!filter[17].sort)
                            {
                                <th>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.Jernsulfat" @bind-value:event="oninput" />
</th>
                            }

                            @if (!filter[18].sort)
                            {
                                <th>

                                <input type="number" class="form-control" @bind-value="RecipeEdit.Temp" @bind-value:event="oninput" />
</th>
                            }
                             @if (!filter[19].sort)
                            {
                                <th>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.Modningstid" @bind-value:event="oninput" />
</th>
                            }
                             @if (!filter[20].sort)
                            {
                                <th>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.DampVentil" @bind-value:event="oninput" />
</th>
                            }
                             @if (!filter[21].sort)
                            {
                                <th>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.Etterspyling" @bind-value:event="oninput" />
</th>
                            }
                             @if (!filter[22].sort)
                            {
                                <th>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.O2Trykk" @bind-value:event="oninput" />
</th>
                            }

                            @if (!filter[23].sort)
                            {
                                <th>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.O2Reaksjonstid" @bind-value:event="oninput" />
</th>
                            }
                             @if (!filter[24].sort)
                            {
                                <th>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.DeltaTemp" @bind-value:event="oninput" />
</th>
                            }

                            @if (!filter[25].sort)
                            {
                                <th>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.AnalysertFe3" @bind-value:event="oninput" />
</th>
                            }

                            @if (!filter[26].sort)
                            {
                                <th>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.AnalysertFeTot" @bind-value:event="oninput" />
</th>
                            }

                            @if (!filter[26].sort)
                            {
                                <th>

                                <input type="number" class="form-control" @bind-value="RecipeEdit.VannSluttJustering" @bind-value:event="oninput" />
</th>
                            }

                            @if (!filter[28].sort)
                            {
                                <th>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.VirkeligMVann" @bind-value:event="oninput"/>
</th>
                            }

                            @if (!filter[29].sort)
                            {
                                <th>
                                <input type="number" class="form-control" @bind-value="RecipeEdit.TotTilLager" @bind-value:event="oninput" />
</th>
                            }

                            
                            <td>
                    <button type="button" class="btn btn-link" @onclick="() => EnableEditing(false, recipe)">
                        <i class="oi oi-trash" />
                    </button>
                    <button type="button" class="btn btn-link">
                        <i class="oi oi-check" />
                    </button>
                </td>
                    }
            }
        </tbody>
    </table>
  </div>




    <div class="btn-group  text-rt" role="group" aria-label="Reset">
        <button type="button" class="btn btn-success btn-lg mx-3" @onclick="() => WriteCSV(filter)">Eksporter til Excel</button>
        <button type="button" class="btn btn-secondary btn-lg text-right" >Reset Tabell</button>
    </div>

    <div class="my-5"></div>

    <h4>Fjerne/Legge til kolonner</h4>

    <ul class="list-group d-inline-block">

@foreach(var variable in filter)
    {


            @if (!variable.sort)
            {
                <li class="list-group-item list-group-item-primary"
              @onclick = "(() => {variable.sort = !variable.sort; StateHasChanged();})">
             
              @variable.variable
            </li>
            }
        else
            {
             <li class="list-group-item list-group-item-secondary"
              @onclick = "(() => {variable.sort = !variable.sort; StateHasChanged();})">
             <del>@variable.variable</del> 
            </li>   
            }

    } 



</ul>




@code {
    public filtering[] filter = new filtering[30];
    private RecipeModels RecipeEdit = new RecipeModels();



    protected override async Task OnInitializedAsync()
    {


        for(int i = 0; i < 30; i++)
        {
            filter[i] = new filtering();
            filter[i].variable = FilterModel.StringFilter[i];
        }

        //Make this part of initialization
        filter[5].sort = true;
        filter[19].sort = true;
        filter[20].sort = true;
        filter[21].sort = true;
        filter[22].sort = true;
        filter[24].sort = true;
        FilterModel.filter[5] = true;
        FilterModel.filter[19] = true;
        FilterModel.filter[20] = true;
        FilterModel.filter[21] = true;
        FilterModel.filter[22] = true;
        FilterModel.filter[24] = true;




    }

    private void EnableEditing(bool flag, RecipeModels batch)
    {
        batch.edit = flag;
        RecipeEdit = batch;
    }


    public void WriteCSV(filtering[] filter)
    {
        DataWrite ToCSV = new DataWrite(filter);

        ToCSV.dataWriteToCSV();

    }


}
